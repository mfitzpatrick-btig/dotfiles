unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Keep prefix-based navigation as fallback
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind r source-file ~/.tmux.conf \; display-message "Config reloaded"

# Open new panes in current directory
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# Start numbering at 1 instead of 0
set -g base-index 1
set -g pane-base-index 1

# Disable automatic window renaming
set-option -wg automatic-rename off

# Enable mouse support
set -g mouse on
set -s set-clipboard on

# Copy to system clipboard via OSC52 (works over SSH)
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "printf '\\033]52;c;%s\\a' \"$(base64 -w0)\""

set-option -g status-position top
set -g pane-border-status top
set -g pane-border-format ""
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

set -g @catppuccin_flavor 'mocha' # latte, frappe, macchiato or mocha
set -g @catppuccin_window_status_style "rounded"

# Load plugins
run '~/.config/tmux/plugins/vim-tmux-navigator/vim-tmux-navigator.tmux'
run '~/.config/tmux/plugins/catppuccin/catppuccin.tmux'

set -gF @catppuccin_custom_cpu_color "#{E:@thm_yellow}"

set -ogqF @catppuccin_status_custom_cpu_icon_fg "#{E:@thm_crust}"
set -ogqF @catppuccin_status_custom_cpu_text_fg "#{E:@thm_fg}"
set -gqF @catppuccin_status_custom_cpu_icon_bg "#{@catppuccin_custom_cpu_color}"
set -gqF @_ctp_module_text_bg "#{E:@catppuccin_status_module_text_bg}"

set -gF @catppuccin_status_custom_cpu "#[fg=#{@catppuccin_status_custom_cpu_icon_bg}]#{@catppuccin_status_left_separator}"
set -agF @catppuccin_status_custom_cpu "#[fg=#{@catppuccin_status_custom_cpu_icon_fg},bg=#{@catppuccin_status_custom_cpu_icon_bg}] "
set -agF @catppuccin_status_custom_cpu "#{@catppuccin_status_middle_separator}"
set -agF @catppuccin_status_custom_cpu "#[fg=#{@catppuccin_status_custom_cpu_text_fg},bg=#{@_ctp_module_text_bg}]"
set -ag @catppuccin_status_custom_cpu " #($HOME/.local/bin/tmux-mem-cpu-load --interval 2 --averages-count 0 | rev | cut -d' ' -f1 | rev)"
set -agF @catppuccin_status_custom_cpu "#[fg=#{@_ctp_module_text_bg}]#{@catppuccin_status_right_separator}"

# Configure status line
set -g status-right-length 100
set -g status-left-length 100

# Custom hostname module with server icon
set -gF @catppuccin_custom_host_color "#{E:@thm_blue}"
set -ogqF @catppuccin_status_custom_host_icon_fg "#{E:@thm_crust}"
set -ogqF @catppuccin_status_custom_host_text_fg "#{E:@thm_fg}"
set -gqF @catppuccin_status_custom_host_icon_bg "#{@catppuccin_custom_host_color}"

set -gF @catppuccin_status_custom_host "#[fg=#{@catppuccin_status_custom_host_icon_bg}]"
set -agF @catppuccin_status_custom_host "#[fg=#{@catppuccin_status_custom_host_icon_fg},bg=#{@catppuccin_status_custom_host_icon_bg}]󰒋 "
set -agF @catppuccin_status_custom_host "#{@catppuccin_status_middle_separator}"
set -agF @catppuccin_status_custom_host "#[fg=#{@catppuccin_status_custom_host_text_fg},bg=#{@_ctp_module_text_bg}] #H "
set -agF @catppuccin_status_custom_host "#[fg=#{@_ctp_module_text_bg},bg=#{@_ctp_status_bg}] "

set -g status-left "#{E:@catppuccin_status_custom_host}"
set -g status-right "#{E:@catppuccin_status_application}"
set -ag status-right "#{E:@catppuccin_status_custom_cpu}"
set -ag status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_uptime}"

# Override window formats to use window name instead of terminal title  
set -gF window-status-format "#[fg=#{@thm_crust},bg=#{@catppuccin_window_number_color}]#{E:@catppuccin_window_left_separator}##I#{E:@catppuccin_window_middle_separator}#[fg=#{@thm_fg},bg=#{@catppuccin_window_text_color}] ##W#{E:@catppuccin_window_right_separator}"
set -gF window-status-current-format "#[fg=#{@thm_crust},bg=#{@catppuccin_window_current_number_color}]#{E:@catppuccin_window_current_left_separator}##I#{E:@catppuccin_window_current_middle_separator}#[fg=#{@thm_fg},bg=#{@catppuccin_window_current_text_color}] ##W#{E:@catppuccin_window_current_right_separator}"
# Update GPG_TTY for each new window/pane
set-option -g update-environment "DISPLAY SSH_ASKPASS SSH_AUTH_SOCK SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY"
set-environment -g 'GPG_TTY' '$(tty)'

# Ensure proper terminal type
set -g default-terminal "screen-256color"
